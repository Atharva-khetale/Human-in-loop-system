<!DOCTYPE html>
<html>
<head>
    <title>Automated Workflow Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="/">
                <i class="fas fa-robot"></i> Automated Human-in-Loop System
            </a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Metrics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-white bg-primary">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-tasks"></i> Total Workflows</h5>
                        <h2 class="card-text">{{ metrics.total }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-success">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-check-circle"></i> Completed</h5>
                        <h2 class="card-text">{{ metrics.completed }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-warning">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-clock"></i> Pending</h5>
                        <h2 class="card-text">{{ metrics.pending }}</h2>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-white bg-danger">
                    <div class="card-body">
                        <h5 class="card-title"><i class="fas fa-exclamation-triangle"></i> Failed</h5>
                        <h2 class="card-text">{{ metrics.failed }}</h2>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Pending Approvals -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-warning text-white">
                        <h5 class="mb-0"><i class="fas fa-user-check"></i> Pending Approvals</h5>
                    </div>
                    <div class="card-body">
                        {% if pending_approvals %}
                            {% for approval in pending_approvals %}
                            <div class="alert alert-warning">
                                <h6>{{ approval.workflow_name }}</h6>
                                <p class="mb-1"><small>{{ approval.metadata.step_name }}</small></p>
                                <p class="mb-2"><strong>Level:</strong> {{ approval.approval_level }}</p>
                                <a href="/approvals" class="btn btn-sm btn-primary">Review</a>
                            </div>
                            {% endfor %}
                        {% else %}
                            <p class="text-muted">No pending approvals</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Recent Workflows -->
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-history"></i> Recent Workflows</h5>
                    </div>
                    <div class="card-body">
                        {% for workflow in workflows %}
                        <div class="border-bottom pb-2 mb-2">
                            <div class="d-flex justify-content-between">
                                <strong>{{ workflow.name }}</strong>
                                <span class="badge 
                                    {% if workflow.status == 'completed' %}bg-success
                                    {% elif workflow.status == 'running' %}bg-primary
                                    {% elif workflow.status == 'awaiting_approval' %}bg-warning
                                    {% elif workflow.status == 'failed' %}bg-danger
                                    {% else %}bg-secondary{% endif %}">
                                    {{ workflow.status }}
                                </span>
                            </div>
                            <small class="text-muted">{{ workflow.task_type }} â€¢ {{ workflow.created_at }}</small>
                            <div class="progress mt-1" style="height: 5px;">
                                <div class="progress-bar" style="width: {{ (workflow.current_step / workflow.steps|length * 100) }}%"></div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-header">
                        <h5 class="mb-0">Quick Actions</h5>
                    </div>
                    <div class="card-body">
                        <a href="/workflows" class="btn btn-primary me-2">
                            <i class="fas fa-list"></i> View All Workflows
                        </a>
                        <a href="/approvals" class="btn btn-warning me-2">
                            <i class="fas fa-check-double"></i> Manage Approvals
                        </a>
                        <button class="btn btn-success" onclick="uploadCSV()">
                            <i class="fas fa-file-csv"></i> Upload CSV Tasks
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function uploadCSV() {
            alert('CSV upload functionality would be implemented here');
            // In production, this would open a file upload dialog
        }

        // Auto-refresh every 30 seconds
        setInterval(() => {
            location.reload();
        }, 30000);
    </script>
</body>
</html>